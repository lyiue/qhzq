<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="layui/css/layui.css" media="all">
    <link rel="stylesheet" href="css/CRindex.css" media="all">
    <title>道路健康评价管理系统</title>
    <style>
        .layui-nav-tree{vertical-align: top;}
        .cr-content{
            height:63px;
            background-color: #e2e2e2;
        }
        .form-header{
            padding-top: 10px;
            display: inline-block;
        }
        body, html,.assess-content{width: 100%;height: 100%;overflow-y: auto;
            overflow-x: hidden;
            background-color: #404866;
            margin:0;font-family:"微软雅黑";position: relative;}
        .layui-form .layui-table tbody tr:hover{background-color:#404866!important}
        .imgButton{
            display: block;
            position: absolute;
            left: 88%;
            top:10px;
        }
        .imgButton img{
            float: left;
            cursor:pointer;
            margin-left: 20px;
        }
        .assess-content .layui-form{
            width:170px;
            margin-left: 28px;
        }
        .layui-form,.assess-chart1{
            float: left;
        }
        .assess-chart1{
            height:320px;
            margin-left: 1%;
            background-color: #353c66;
            border-radius: 15px;
        }
        .assess-content .layui-form .layui-form-item{
            width:80px;
            float: left;
            clear: none;
        }
        .assess-content .layui-form .layui-form-item .layui-input-inline{
            width:60px;
            display: inline-block;

        }
        .layui-form-radio{
            width:70px;
            color: white;
            margin-bottom: 6px;
        }
        .layui-form-label{
            text-align: center;
        }
        .assess-chart1 .layui-form .layui-form-item .layui-input-inline{
            width:270px;
        }
        .assess-chart1 .layui-form .layui-form-item{
            width:270px;
        }
        .assess-chart1 .layui-form .layui-form-item .layui-form-radio{
            float: left;
            clear: none;
        }
        .woc .assess-form{
            width: 100%;margin-left: 0
        }
        .woc .assess-table{
            background-color: inherit;color: white
        }
        .woc .assess-table td{
            border:0;
        }
        .woc .assess-table td>div{
            height:400px;
        }
        #echartZ div canvas{
            position: absolute;
            left: 15px;
            top: -15px;
        }
        .layui-table td{
            padding:9px 15px 9px 0;
        }
    </style>
</head>
<body>

<div class="layui-fluid">
    <div class="row">
        <div class="layui-side layui-bg-black">
            <div class="layui-side-scroll">
                <ul class="layui-nav layui-nav-tree">
                    <li class="layui-nav-item layui-nav-item-first layui-nav-itemed ">
                        <a class="userSet" href="editinfo.html">
                            <img src="image/用户.png" style="display: inline-block">
                            <img src="image/用户_12.png" class="MunePich" style="display: none">
                            <p></p>
                        </a>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="index.html">
                            <img src="image/gis.png" style="display: inline-block">
                            <img src="image/gis_h.png" class="MunePich" style="display: none">
                            <p>GIS路况</p>
                        </a>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed ">
                        <a href="#">
                            <img src="image/基础.png" style="display: inline-block">
                            <img src="image/基础_h.png" class="MunePich" style="display: none">
                            <p>基础数据</p>
                        </a>
                        <dl class="layui-nav-child">
                            <dd class=""><a href="CR.baseInfo.html">静态数据</a></dd>
                            <dd><a href="Roadsituation.html">道路现状</a></dd>
                            <dd><a href="Roadrecords.html">健康档案</a></dd>
                        </dl>
                    </li>

                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="#">
                            <img src="image/基础.png" style="display: inline-block">
                            <img src="image/基础_h.png" class="MunePich" style="display: none">
                            <p>技术评定</p>
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a href="RoadtestReport.html">检测报告</a></dd>
                            <dd class=" layui-this"><a href="#">评定分析</a></dd>
                            <dd><a href="sequential.html">环比分析</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="#">
                            <img src="image/病害.png" style="display: inline-block">
                            <img src="image/病害_h.png" class="MunePich" style="display: none">
                            <p>病害诊断</p>
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a href="Roaddisease.html">病害统计</a></dd>
                            <dd><a href="Roaddiseases.it.html">病害成因分析</a></dd>
                            <dd><a href="">3D展示</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="RoadPipeline.html">
                            <img src="image/管线.png" style="display: inline-block">
                            <img src="image/管线_h.png" class="MunePich" style="display: none">
                            <p>管线档案</p>
                        </a>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="RoadInfo.html">
                            <img src="image/路网.png" style="display: inline-block">
                            <img src="image/路网_h.png" class="MunePich" style="display: none">
                            <p>路网档案</p>
                        </a>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="#">
                            <img src="image/养护.png" style="display: inline-block">
                            <img src="image/路网_h.png" class="MunePich" style="display: none">
                            <p>养护科学决策</p>
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a href="RoadDecisiontree.html">决策树</a></dd>
                            <dd><a href="Maintenanceadvice.html">养护建议</a></dd>
                            <dd><a href="Maintenanceevaluation.html">养护报告</a></dd>
                            <dd><a></a></dd>
                        </dl>
                    </li>
                </ul>
            </div>
        </div>
        <div class="cr-content">
            <form class="layui-form form-header" action="">
                <div class="layui-inline">
                    <label class="layui-form-label">道路选择</label>
                    <div class="layui-input-inline">
                        <select name="getRoadlist" lay-filter="getRoad">
                        </select>
                    </div>
                </div>
               
            </form>
            <div class="imgButton">
                <img src="image/切换.png" class="userTypeBut1" style="display: none">
                <img src="image/设置.png" class="userTypeBut2" style="display: none">
                <img src="image/退出.png" class="userExit">
            </div>
        </div>
        <!--评定分析-->
        <div class="assess-content">
            <div id="assessContainer">
                <fieldset class="layui-elem-field layui-field-title">
                    <legend>评定等级</legend>
                </fieldset>
                <form class="layui-form hhh" action="">
                    <div class="layui-form-item">
                        <div class="layui-input-inline">
                            <input type="radio" name="EvaluateType" value="" title="总"  dataradio = "z"  checked="" lay-filter="radio">
                            <input type="radio" name="EvaluateType" value="RoadPQI"  dataradio = "p" title="PQI" lay-filter="radio">
                            <input type="radio" name="EvaluateType" value="RoadPCI" dataradio = "p" title="PCI" lay-filter="radio">
                            <input type="radio" name="EvaluateType" value="RoadRQI" dataradio = "p" title="RQI" lay-filter="radio">
                            <input type="radio" name="EvaluateType" value="RoadTD"  dataradio = "p"title="TD" lay-filter="radio">
                            <input type="radio" name="EvaluateType" value="RoadSFC" dataradio = "p" title="SFC" lay-filter="radio">
                            <input type="radio" name="EvaluateType" value="RoadCH"  dataradio = "p"title="层厚" lay-filter="radio">
                            <!--<input type="radio" name="EvaluateType" value="RoadKD" dataradio = "p" title="空洞" lay-filter="radio">-->
                        </div>
                    </div>
                    <div class="layui-form-item" style="margin-top: 41px;">
                        <div class="layui-input-inline">
                            <input type="radio" name="EvaluateType" value="RoadPQI" dataradio = "h" title="环比" lay-filter="radio">
                            <input type="radio" name="EvaluateType" value="RoadPCI"  dataradio = "h" title="环比" lay-filter="radio">
                            <input type="radio" name="EvaluateType" value="RoadRQI" dataradio = "h" title="环比" lay-filter="radio">
                            <input type="radio" name="EvaluateType" value="RoadTD" dataradio = "h" title="环比" lay-filter="radio">
                            <input type="radio" name="EvaluateType" value="RoadSFC" dataradio = "h" title="环比" lay-filter="radio">
                            <input type="radio" name="EvaluateType" value="RoadCH" dataradio = "h" title="环比" lay-filter="radio">
                            <!--<input type="radio" name="EvaluateType" value="RoadKD" dataradio = "h" title="环比" lay-filter="radio">-->
                        </div>
                    </div>
                </form>
                <div class="assess-chart1" style="height: 500px;">
                    <form class="layui-form" action="" >
                        <div class="layui-form-item">
                            <div class="layui-input-inline">
                                <input type="radio" name="RoadClass" value="总" title="总" checked lay-filter="radio">
                                <input type="radio" name="RoadClass" value="上" title="上" lay-filter="radio">
                                <input type="radio" name="RoadClass" value="下" title="下" lay-filter="radio">
                            </div>
                        </div>
                    </form>
                    <div id="echartZ" style="height:430px;margin-top: 35px;"></div>
                </div>
                <div class="woc">
                    <form class="layui-form assess-form">
                        <table class="layui-table assess-table">
                            <tbody>
                                <tr>
                                    <td>
                                        <fieldset class="layui-elem-field layui-field-title">
                                            <legend>PQI</legend>
                                        </fieldset>
                                        <div class="RoadPQI"></div>
                                    </td>
                                    <td>
                                        <fieldset class="layui-elem-field layui-field-title">
                                            <legend>PCI</legend>
                                        </fieldset>
                                        <div class="RoadPCI"></div>
                                    </td>
                                    <td>
                                        <fieldset class="layui-elem-field layui-field-title">
                                            <legend>RQI</legend>
                                        </fieldset>
                                        <div class="RoadRQI"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <fieldset class="layui-elem-field layui-field-title">
                                            <legend>TD</legend>
                                        </fieldset>
                                        <div class="RoadTD"></div>
                                    </td>
                                    <td>
                                        <fieldset class="layui-elem-field layui-field-title">
                                            <legend>SFC</legend>
                                        </fieldset>
                                        <div class="RoadSFC"></div>
                                    </td>
                                    <td>
                                        <fieldset class="layui-elem-field layui-field-title">
                                            <legend>CH</legend>
                                        </fieldset>
                                        <div class="RoadCH"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="js/jquery-1.9.1.min.js"></script>
<script src="layui/layui.js" charset="utf-8"></script>
<script src="js/echarts.min.js"></script>
<script src="js/IP.js"></script>
<script src="js/index.js"></script>
<script src="js/jquery.serializejson.js"></script>
<script>
    layui.use(['element','form'], function(){
        var element = layui.element;
        var form = layui.form;



        /*功能条*/
        localStorage.getItem("UserType");
        if(localStorage.getItem("UserType") == 0){
            /*普通用户*/
            $('.userTypeBut2').css('display','block');
        }
        if(localStorage.getItem("UserType") == 1){
            /*工作用户*/
            $('.userTypeBut1').css('display','block');
            $('.userSet').unwrap().wrap('<div class="layui-nav-item layui-nav-item-first layui-nav-itemed"><a class="userSet">'+
                '<img src="image/用户.png" style="display: inline-block">'+
                '<img src="image/用户_12.png" class="MunePich" style="display: none">'+
                '<p></p>'+ '</a></div>')
        }
        /*导航条*/
        var UserName = localStorage.getItem('UserName');
        var UserUnitName = localStorage.getItem('UserUnitName');
        $('.layui-nav-item-first p').html(UserName+':'+UserUnitName);

        $('.userExit').on('click',function () {
            localStorage.removeItem('UserName');
            localStorage.removeItem('UserType');
            localStorage.removeItem('_id');
            localStorage.removeItem('selectId');
            localStorage.removeItem('superId');
            location.href='login.html';
        });
        $('.userTypeBut1').on('click',function () {
            localStorage.setItem('selectId','');
            location.href='superperson.html';
        });
        $('.userTypeBut2').on('click',function () {
            location.href='editinfo.html';
        });

        $('#echartZ canvas').css('width',assWidth.width()*0.8);
        $('.woc .assess-table td').css('width','30%');
        $('.woc .assess-table td div').css('width','100%');
        $(window).resize(function () {
            $('#echartZ canvas').css('width',assWidth.width()*0.8);
            $('.woc .assess-table td').css('width','25%');
            $('.woc .assess-table td div').css('width','100%');
        });

        /*
         * 获取所有道路
         * */
        getRoadlist();

        function getRoadlist() {
            $.ajax({
                type: 'get',
                url: 'http://'+ip+ '/api/RoadInfo/getRoadlist',
                data: {
                    "UserID": localStorage.getItem("_id")
                },
                success: function (data) {
                    //console.log(data);
                    var roadLength = data.message.length;
                    var roadName = '';
                    for (var i = 0; i < roadLength; i++) {
                        //获取所有道路名称
                        var BI_RoadName = data.message[i].BI_RoadName;
                        var RoadID = data.message[i]._id;
                        roadName += '<option value="' + RoadID + '">' + BI_RoadName + '</option>';
                    }
                    $('select[name="getRoadlist"]').append(roadName);
                    if(localStorage.getItem("selectId") == undefined || localStorage.getItem("selectId") == null || localStorage.getItem("selectId") == ''){
                        $('select[name="getRoadlist"]').val($('select').children().eq(0).val());
                        localStorage.setItem("selectId",$('select option:selected').val());
                    }else{
                        $('select[name="getRoadlist"]').val(localStorage.getItem("selectId"));
                    }
                    form.render('select');
                    form.on('select(getRoad)', function(a){
                        getZong();
                    });
                    form.on('radio(radio)',function () {
                         var vl=$('input[name="EvaluateType"]:checked').attr("dataradio");
                        if(vl=="z"){
                            getZong();
                            $('.DiseasePie').css('display','none');
                            $('.woc').css('display','block');
                        }
                        if(vl=="p"){
                            getEvaluateType();
                        }
                        if(vl=="h"){
                            getEvaluateType_hb();
                        }
                    });
                    getZong();
                }
            });
        }


        //不同类型
        function getEvaluateType() {
            $.ajax({
                type:'get',
                url:'http://'+ip+'/api/GetRoadData/getEvaluateType',
                data:{
                    RoadID: $('select option:selected').val(),//道路选中Id
                    RoadClass:$('input[name="RoadClass"]:checked').val(),
                    EvaluateType:$('input[name="EvaluateType"]:checked').val()
                },
                success:function (dataZ) {
                    //console.log(dataZ);
                    localStorage.setItem("selectId",$('select option:selected').val());
                    var myChart = echarts.init(document.getElementById('echartZ'));
                    option = {
                        tooltip: {
                            trigger: 'axis'
                            ,axisPointer : {
                                type : 'line'
                            }
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        toolbox: {
                            show : false,
                            feature: {
                                saveAsImage: {}
                            }
                        },
                        xAxis: {
                            type: 'category',
                            boundaryGap: false,
                            data: dataZ.message.x,
                            splitLine:{show: false},//去除网格线
                            splitArea : {show : false},
                            axisLine: {
                                lineStyle: {
                                    type: 'solid',
                                    color: '#fff',//左边线的颜色
                                    width:'1'//坐标线的宽度
                                }
                            },
                            axisLabel: {
                                textStyle: {
                                    color: '#fff'//坐标值得具体的颜色
                                }
                            }
                        },
                        yAxis: {
                            type: 'value',
                            splitLine:{show: false},//去除网格线
                            splitArea : {show : false},
                            axisLine: {
                                lineStyle: {
                                    type: 'solid',
                                    color: '#fff',//左边线的颜色
                                    width:'1'//坐标线的宽度
                                }
                            },
                            axisLabel: {
                                textStyle: {
                                    color: '#fff',//坐标值得具体的颜色

                                }
                            }
                        },
                        series: [
                            {
                                name:$('.hhh .layui-form-radioed span').text(),
                                type:'line',
                                data:dataZ.message.y,
                            }
                        ]
                    };
                    myChart.setOption(option,true);

                }
            })
        }


        //不同类型 环比
        function getEvaluateType_hb() {
            $.ajax({
                type:'get',
                url:'http://'+ip+'/api/GetRoadData/getEvaluateType_hb',
                data:{
                    RoadID: $('select option:selected').val(),//道路选中Id
                    RoadClass:$('input[name="RoadClass"]:checked').val(),
                    EvaluateType:$('input[name="EvaluateType"]:checked').val()
                },
                success:function (dataZ) {
                    //console.log(dataZ);
                    localStorage.setItem("selectId",$('select option:selected').val());
                    var myChart = echarts.init(document.getElementById('echartZ'));
                    option = {
                        tooltip : {
                            trigger: 'axis',
                            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                                type : 'line'        // 默认为直线，可选为：'line' | 'shadow'
                            }
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        toolbox: {
                            show : false,
                            feature: {
                                saveAsImage: {}
                            }
                        },
                        xAxis: {
                            type: 'category',
                            boundaryGap: false,
                            data: dataZ.message.x,
                            splitLine:{show: false},//去除网格线
                            splitArea : {show : false},
                            axisLine: {
                                lineStyle: {
                                    type: 'solid',
                                    color: '#fff',//左边线的颜色
                                    width:'1'//坐标线的宽度
                                }
                            },
                            axisLabel: {
                                textStyle: {
                                    color: '#fff'//坐标值得具体的颜色

                                }
                            }
                        },
                        yAxis: {
                            type: 'value',
                            splitLine:{show: false},//去除网格线
                            splitArea : {show : false},
                            axisLine: {
                                lineStyle: {
                                    type: 'solid',
                                    color: '#fff',//左边线的颜色
                                    width:'1'//坐标线的宽度
                                }
                            },
                            axisLabel: {
                                textStyle: {
                                    color: '#fff'//坐标值得具体的颜色
                                }
                            }
                        },
                        series: [
                            {
                                name:'',
                                type:'bar',
                                barWidth: '10%',
                                data:dataZ.message.y,
                                itemStyle:{
                                    normal:{
                                        color:'#ff5140'
                                    }
                                }
                            }
                        ]
                    };
                    myChart.setOption(option,true);

                }
            })
        }

        //获取总
        function getZong() {
            //console.log($('select option:selected').val());
            $.ajax({
                type:'get',
                url:'http://'+ip+'/api/GetRoadData/getEvaluateTotal',
                data:{
                    RoadID: $('select option:selected').val(),//道路选中Id
                    RoadClass:$('input[name="RoadClass"]:checked').val(),
                    EvaluateType:$('input[name="EvaluateType"]:checked').val()
                },
                success:function (dataZ) {
                    //console.log(dataZ);
                    localStorage.setItem("selectId",$('select option:selected').val());
                        var myChart = echarts.init(document.getElementById('echartZ'));
                        var hours = dataZ.message.total.hours;
                        var days = dataZ.message.total.days;
                        var data = dataZ.message.total.data;
                        option = {
                            tooltip: {
                                position: 'top'
                            },
                            title: [],
                            singleAxis: [],
                            series: []
                        };
                        echarts.util.each(days, function (day, idx) {
                            option.title.push({
                                textBaseline: 'middle',
                                top: (idx + 0.5) * 100 / 8 + '%',
                                left: 0.1 * 5 + '%',
                                text: day,
                                textStyle:{
                                    color:"#fff",
                                    fontSize:16,
                                    fontWeight:'normal'
                                }
                            });
                            option.singleAxis.push({
                                left: 60,
                                type: 'category',
                                boundaryGap: false,
                                data: hours,
                                top: (idx * 100 / 8 + 5) + '%',
                                height: (100 / 8 - 10) + '%',
                                axisLabel: {
                                    interval: 0
                                },
                                axisLine:{
                                    lineStyle:{
                                        color:"#fff"
                                    }
                                },
                                splitLine:{
                                    lineStyle:{
                                        color:"#fff"
                                    }
                                }

                            });
                            option.series.push({
                                singleAxisIndex: idx,
                                coordinateSystem: 'singleAxis',
                                type: 'scatter',
                                data: [],
                                symbolSize: function (dataItem) {
                                    return dataItem[1] * 4;
                                },
                                textstyle:{
                                    color: '#fff',
                                }
                            });
                        });

                        echarts.util.each(data, function (dataItem) {
                            option.series[dataItem[0]].data.push([dataItem[1], dataItem[2]]);
                        });
                         myChart.setOption(option,true);

                        var arr = ['RoadRQI', 'RoadPQI', 'RoadPCI','RoadTD', 'RoadSFC', 'RoadCH'];

                        for(var i=0;i<arr.length;i++){
                            for(var key in dataZ.message){
                                if(arr[i] == key){
                                    arrFn(key,dataZ.message[key].x,dataZ.message[key].y)
                                }
                            }
                        }
                        function arrFn(arrClass,x,y) {
                            var arritem =  echarts.init(document.getElementsByClassName(arrClass)[0]);
                            arrData = {
                                tooltip: {
                                    trigger: 'axis'
                                },
                                grid: {
                                    left: '3%',
                                    right: '4%',
                                    bottom: '3%',
                                    containLabel: true
                                },
                                toolbox: {
                                    show : false,
                                    feature: {
                                        saveAsImage: {}
                                    }
                                },
                                xAxis : [
                                    {
                                        type : 'category',
                                        boundaryGap: false,
                                        data : x,
                                        splitLine:{show: false},//去除网格线
                                        splitArea : {show : false},//保留网格区域
                                        axisLine: {
                                            lineStyle: {
                                                type: 'solid',
                                                color: '#fff',//左边线的颜色
                                                width:'1'//坐标线的宽度
                                            }
                                        },
                                        axisLabel: {
                                            textStyle: {
                                                color: '#fff',//坐标值得具体的颜色

                                            }
                                        }
                                    }
                                ],
                                yAxis : [
                                    {
                                        type : 'value',
                                        splitLine:{show: false},//去除网格线
                                        splitArea : {show : false},//保留网格区域
                                        axisLine: {
                                            lineStyle: {
                                                type: 'solid',
                                                color: '#fff',//左边线的颜色
                                                width:'1'//坐标线的宽度
                                            }
                                        },
                                        axisLabel: {
                                            textStyle: {
                                                color: '#fff'//坐标值得具体的颜色

                                            }
                                        }
                                    }
                                ],
                                series : [
                                    {
                                        name:arrClass,
                                        type:'line',
                                        data:y
                                    }
                                ]
                            };
                            arritem.setOption(arrData);
                        }
                }
            })
        }


    });
</script>
</body>
</html>